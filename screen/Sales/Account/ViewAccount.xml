<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        default-menu-title="View Account">
    <parameter name="partyId" required="true"/>
    <subscreens default-item="Activity"/>
    <actions>
        <!-- This approach is the same as what is used in EditParty screen -->
        <entity-find-one entity-name="mantle.party.PartyDetail" value-field="party"/>
        <if condition="party == null"><return error="true" message="Party not found with ID ${partyId}"/></if>
    </actions>
    <widgets>
        <container-row><row-col lg="3">
                <section name="PartySummarySection">
                    <actions>
                        <!-- this approach is the same as what is used in EditParty screen -->
                        <service-call name="mantle.party.ContactServices.get#PartyContactInfoList" out-map="contactOut"
                                      in-map="[partyId:partyId, getAll:true]"/>
                    </actions>
                    <widgets>
                        <container-box type="default"><box-header title="${party.organizationName}"/>
                            <box-body-nopad>
                                <!-- Display primary website and phone -->
                                <section-iterate name="WebInfoSection" list="contactOut.webAddressList" entry="contactInfo">
                                    <widgets><container-row><row-col lg="7">
                                        <!--<link url="${contactInfo.webAddress}" text="${contactInfo.webAddress}" link-type="anchor"/> -->
                                        <render-mode><text type="html,vuet,qvt" location="component://SimpleScreens/template/party/ContactInfo.html.gstring"/></render-mode>
                                        </row-col><row-col lg="5">
                                        <dynamic-dialog id="UpdateWebInfo" button-text="Update" transition="UpdateContactInfo"
                                                        parameter-map="[partyId:partyId, webContactMechId:contactInfo.webContactMechId,
                                        webContactMechPurposeId:contactInfo.webContactMechPurposeId]"/>
                                        <link url="removeContactInfo" text=" " icon="fa fa-trash" confirmation="Remove Web URL?"
                                              parameter-map="[partyId:partyId, contactMechId:contactInfo.webContactMechId,
                                        contactMechPurposeId:contactInfo.webContactMechPurposeId]"/>
                                    </row-col></container-row></widgets>
                                </section-iterate>
                                <section-iterate name="PhoneInfoSection" list="contactOut.telecomNumberList" entry="contactInfo">
                                    <widgets><container-row><row-col lg="7">
                                        <render-mode><text type="html,vuet,qvt" location="component://SimpleScreens/template/party/ContactInfo.html.gstring"/></render-mode>
                                        </row-col><row-col lg="5">
                                        <dynamic-dialog id="UpdatePhoneInfo" button-text="Update" transition="UpdateContactInfo"
                                                        parameter-map="[partyId:partyId, telecomContactMechId:contactInfo.telecomContactMechId,
                                        telecomContactMechPurposeId:contactInfo.telecomContactMechPurposeId]"/>
                                        <link url="removeContactInfo" text=" " icon="fa fa-trash" confirmation="Remove phone number?"
                                              parameter-map="[partyId:partyId, contactMechId:contactInfo.telecomContactMechId,
                                        contactMechPurposeId:contactInfo.telecomContactMechPurposeId]"/>
                                    </row-col></container-row></widgets>
                                </section-iterate>
                                <button-menu text="Add New" icon="fa fa-plus">
                                    <dynamic-dialog id="AddPhoneInfo" button-text="Phone" transition="UpdateContactInfo"
                                                    parameter-map="[partyId:partyId, createTelecom:'true']"/>
                                    <dynamic-dialog id="AddEmailInfo" button-text="Email" transition="UpdateContactInfo"
                                                    parameter-map="[partyId:partyId, createEmail:'true']"/>
                                    <dynamic-dialog id="AddWebUrlInfo" button-text="URL" transition="UpdateContactInfo"
                                                    parameter-map="[partyId:partyId, createWeb:'true']"/>
                                </button-menu>
                            </box-body-nopad>
                        </container-box>
                    </widgets>
                </section>
            </row-col>-
            <row-col lg="6">
                <subscreens-panel id="CenterPanel" type="tab"/>
            </row-col>
            <row-col lg="3">
                <section name="ContactSection">

                    <actions>
                        <entity-find entity-name="mantle.party.PartyRelationship" list="contactList">
                            <econdition field-name="toPartyId" from="partyId"/>
                            <econdition field-name="fromRoleTypeId" value="Contact"/>
                        </entity-find>
                        <entity-find-count entity-name="mantle.party.PartyRelationship" count-field="relationshipCount">
                            <econdition field-name="toPartyId" from="partyId"/></entity-find-count>
                    </actions>

                    <widgets>
                        <container-box type="default"><box-header title="Contacts"/>
                            <box-body-nopad>
                                <label text="Contacts Related to Account: ${relationshipCount}"/>
                                <!-- Display contacts associated with sales account.
                                 How to do this with section-iterate and just display simple text?
                                <section-iterate name="ContactIterateSection" list="contactList" entry="contact">
                                    <widgets>
                                        <label text="From Party: ${contact.fromPartyId}" type="p"/>
                                        <label text="PartyNameOnlyTemplate" text-map="contact" type="p"/>
                                        <display text="PartyNameOnlyTemplate" text-map="contact"/>
                                        <display-entity entity-name="mantle.party.PartyDetail" key-field-name="fromPartyId" text="PartyNameOnlyTemplate"/>
                                    </widgets>
                                </section-iterate>
                                -->
                                <!-- Using form list until I figure out the above approach. -->
                                <form-list name="ContactList" list="contactList" skip-header="true">
                                    <field name="fromPartyId">
                                        <default-field title="Contact Name">
                                            <display-entity entity-name="mantle.party.PartyDetail" text="PartyNameOnlyTemplate"/>
                                        </default-field>
                                    </field>
                                </form-list>
                            </box-body-nopad>
                        </container-box>
                    </widgets>
                </section>
            </row-col>
        </container-row>
    </widgets>
</screen>