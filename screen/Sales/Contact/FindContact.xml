<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns=""
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        require-authentication="true" default-menu-title="Find Contact">

    <transition name="createContact"><service-call name="mantle.sales.AccountServices.create#Contact"/>
        <default-response url="../EditCustomer"/></transition>
    <transition-include name="searchPartyList" location="component://SimpleScreens/template/party/PartyForms.xml"/>

    <widgets>
        <container-dialog id="CreateContactDialog" button-text="New Sales Contact">
            <form-single name="CreateContactForm" transition="createContact"
                         extends="component://SimpleScreens/screen/SimpleScreens/Party/FindParty.xml#CreateContactForm"/>
        </container-dialog>
        <form-list name="ContactList" list="contactList" skip-form="true" header-dialog="true" select-columns="true" saved-finds="true"
                   show-csv-button="true" show-xlsx-button="true" show-all-button="true">
            <entity-find entity-name="mantle.party.ContactAndRelationship" list="contactList">
                <econdition field-name="roleTypeId" value="Contact"/>
                <econdition field-name="toRoleTypeId" value="Account" or-null="true"/>
                <econdition field-name="toPartyId" ignore-if-empty="true"/>
            </entity-find>
            <row-actions>
                <!-- Get contact email address -->
                <entity-find entity-name="mantle.party.contact.PartyContactMechInfo" list="emailList">
                    <econdition field-name="partyId"/>
                    <econdition field-name="contactMechPurposeId" value="EmailPrimary"/>
                </entity-find>
            </row-actions>
            <field name="partyId"><default-field title="Contact Name"><display-entity entity-name="mantle.party.PartyDetail" text="PartyNameOnlyTemplate"/>
                </default-field>
            </field>
            <field name="contactEmail">
                <default-field title="Email Address">
                    <section-iterate name="EmailList" list="emailList" entry="email"><widgets>
                        <label text="${email.infoString}"/>
                    </widgets></section-iterate>
                </default-field>
            </field>
            <field name="toPartyId">
                <header-field title="Sales Account">
                    <drop-down allow-empty="true">
                        <dynamic-options transition="searchPartyList" server-search="true" min-length="2" parameter-map="[roleTypeId:'Account']"/>
                    </drop-down>
            </header-field>
                <default-field><display-entity entity-name="mantle.party.PartyDetail" text="PartyNameOnlyTemplate"/>
                </default-field>
            </field>
            <field name="submitButton">
                <header-field title="Find"><submit/></header-field>
            </field>
        </form-list>
    </widgets>
</screen>